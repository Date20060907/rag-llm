Санкт-Петербургский государственный университет
телекоммуникаций
им. проф. М. А. Бонч-Бруевича
Кафедра Защищенных систем связи

Разработка защищенного
программного обеспечения

Лекция №4

Системы контроля версий

2

Система контроля версий
Системы управления версиями (Version Control Systems, VCS) или
Системы управления исходным кодом (Source Management
Systems, SMS) — важный аспект разработки
современного
ПО.
VCS предоставляет следующие возможности:
• Поддержка хранения
файлов в репозитории.
• Поддержка истории версий
файлов в репозитории.
• Нахождение конфликтов при изменении
исходного
кода и обеспечение синхронизации
при работе в
многопользовательской средеразработки.
• Отслеживание авторов изменений.
3

Классификация:
• Централизованные/распределённые — в централизованных
системах контроля версий вся работа производится с
центральным репозиторием, в распределённых — у каждого
разработчика
есть локальная копия репозитория.
• Блокирующие/не блокирующие — блокирующие системы
контроля версий позволяют наложить запрет на изменение
файла, пока один из разработчиков работает над ним, в
неблокирующих один файл может одновременно изменяться
несколькими разработчиками.
• Для текстовых данных/для бинарных данных — для VCS для
текстовых данных очень важна поддержка слияния
изменений, для VCS с бинарными данными важна
возможность блокировки.

4

Ежедневный цикл работы
Обычный цикл работы разработчика выглядит следующим
образом:
• Обновление рабочей копии.
– Разработчик выполняет операцию обновления рабочей копии
(update) насколько возможно

• Модификация проекта.

– Разработчик локально модифицирует проект, изменяя входящие
в него файлы в рабочей копии.

• Фиксация изменений.

– Завершив очередной этап работы над заданием, разработчик
фиксирует (commit) свои изменения, передавая их на сервер. VCS
может требовать от разработчика перед фиксацией выполнить
обновление.
5

Основные термины:
• working copy – рабочая (локальная) копия документов;
• repository, depot — хранилище;
• revision — версия документа. Новые изменения (changeset) создают
новую ревизию репозитория;
• check-­in,
‐ commit, submit – фиксация изменений;
• check-­out,
‐
clone —извлечение
документа из
хранилища и создание
рабочей копии;
• update, sync — синхронизация
рабочей копии до
некоторого заданного
состояния
хранилища (в
т.ч. И к более старому состоянию, чем текущее);
• merge, integration — слияние независимых изменений;
• conflict — ситуация, когда несколько пользователей сделали
изменения одного и того же участка документа;
• head — самая свежая версия (revision) в хранилище;
• origin — имя главного сервера.

6

Ветвление
• Ветвь (branch) — направление разработки проекта,
независимое от других.
– Ветвь представляет собой копию части (как правило, одного
каталога) хранилища, в которую можно вносить свои
изменения, не влияющие на другие ветви.
– Документы в разных ветвях имеют одинаковую
историю до
точки ветвления и разные — после неё.
– Изменения из одной ветви можно переносить в другую.

• Ствол (trunk, mainline, master) — основная ветвь
разработки проекта.
7

Локальные системы контроля версий

8

Централизованные системы контроля версий

9

Распределённые системы контроля версий

10

Основные VCS
Standalone

1975

1985

SCCS RCS

Centralized

1990
CVS

1995
VSS

ClearCase

Distributed

2000

2005

SVN
DCVS

Pre
for BitKeeper
ce

2010
TFS

git
Bazaar
Mercurial

Жирным выделены Open Source VCS

11

Краткое описание CSV
• Git (http://git-scm.com/) - распределенная система
контроля версий, разработанная Линусом Торвальдсом.
Изначально Git предназначалась для использования в
процессе разработки ядра Linux, но позже стала
использоваться и во многих других проектах — таких, как,
например, X.org и Ruby on Rails, Drupal.
• Mercurial
(http://www.selenic.com/mercurial/)
распределенная система, написанная на языке Python с
несколькими расширениями на C. Из использующих
Mercurial проектов можно назвать, такие, как, Mozilla и
MoinMoin.
12

Краткое описание CSV
• Bazaar (http://bazaar-vcs.org/) - система разработка которой
поддерживается компанией Canonical — известной своими
дистрибутивом Ubuntu и сайтом https://launchpad.net/. Система в
основном написана на языке Python и используется такими
проектами, как, например, MySQL.
• Codeville
(http://codeville.org/)
написанная
на
Python
распределенная система использующая инновационный алгоритм
объединения изменений (merge). Система используется, например,
при разработке оригинального клиента BitTorrent.
• Darcs (http://darcs.net/) - распределенная система контроля версий
написанная на Haskell используемая, например, проектом Buildbot.
• Monotone (http://monotone.ca/) - система написанная на C++ и
использующая SQLite как хранилище ревизий.
13

Краткая история Git
Основные требования:
• Скорость.
• Простота дизайна.
• Поддержка
нелинейной
разработки
(тысячи
параллельных веток).
• Полная распределённость.
• Возможность эффективной работы с такими большими
проектами, как ядро Linux (как по скорости, так и по
размеру данных).
14

Жизненный цикл git

15

Хранение данных
SVN

git

16

Объекты
• blob (содержимое файлов).
• tree (папки и имена файлов со ссылками на
соответствующие объекты).
• commit (tree + метаданные + родительские
коммиты).
Ветки это просто указатели на определенные
коммиты.

17

Хранение информации в git

18

Ветвление
•git clone http://gitlab.dev.ccfit.nsu.ru/students2016/example.git
•git branch testing

19

Ветвление
•git checkout testing

20

Ветвление
•git commit –a –m ‘change in the file’

21

Ветвление
•git checkout master
•git commit –a –m ‘another change in the file’

22

Слияние веток

git merge hotfix

23

Слияние веток
•git merge iss53

24

Перебазирование
git checkout feature
git rebase master

•
•
•

git rebase --abort
git rebase --continue
git rebase --skip

25

Слияние или перебазирование

26

Слияние или перебазирование
Поскольку git умеет изменять локальную историю,
часто используется такой workflow:
•
При разработке изменения коммитятся очень часто и
довольно грязно.
•
Как только разработка завершена делается rebase к master
•
Все коммиты сбрасываются и изменения остаются только в
рабочей копии.
•
С помощью команд add -i и commit изменения
группируются по смыслу.
•
Уже причесанные изменения заливаются в удаленный
репозиторий.
27

Установка GIT
Система RPM:
dnf install git-all
Система Dpkg:
apt install git

28

Имя пользователя
Первое, что вам следует сделать после установки
Git'а, — указать ваше имя и адрес электронной почты:
git config --global user.name “Denis Kasatkin"
git config --global user.email d.kasatkin@outlook.com

29

Проверка настроек
Если вы хотите проверить используемые настройки, можете
использовать команду git config --list, чтобы показать все,
которые Git найдёт:
• git config --list
• user.name=Denis Kasatkin
• user.email=d.kasatkin@outlook.com
• color.status=auto
• color.branch=auto
• color.interactive=auto
• color.diff=auto

30

Создание Git-репозитория
• Для создания Git-репозитория существуют два
основных подхода.
– Первый подход — импорт в Git уже существующего проекта
или каталога.
– Второй — клонирование уже существующего репозитория с
сервера.

• Создание репозитория в существующем каталоге
– Если вы собираетесь начать использовать Git для
существующего проекта, то вам необходимо перейти в
проектный каталог и в командной строке ввести
– git init
31

Версионный контроль
Если вы хотите добавить под версионный контроль
существующие файлы (в отличие от пустого каталога), вам
стоит проиндексировать эти файлы и осуществить первую
фиксацию изменений. Осуществить это вы можете с
помощью нескольких команд git add указывающих
индексируемые файлы, а затем commit:
git add *.c
git add README
git commit -m 'initial project version'
32

Требования к commit message
• Комментарий не должен быть пустым.
• Комментарий должен отвечать на вопрос что и зачем было сделано.
• Комментарий должен быть лаконичным (twitter style).
• Ссылки на задачу в багтрекере вполне достаточно.
• Комментарий должен быть на английском.
Примеры хороших комментариев:
• Fixed typo in window titile
• Fix #7256 "flush tile cache" takes forever -> See progress advancement
and allow to cancel it
• See #7303: Added option to run Download dialog on startup and help
line in non-expert mode
33

Работа с локальным репозиторием
Команда commit сохраняет текущий stage в
локальный репозиторий.

git commit
git commit --amend

Команда branch создает/удаляет новую ветку.

git branch
git branch test
git branch

Команда checkout переключает рабочую копию на
другую ветку.

git checkout test
Switched to branch 'test'

34

Работа с удаленным репозиторием
Команда clone клонирует репозиторий и создает рабочую копию.

git clone git@github.com:kothic/kothic-js.git

Команда push отправляет изменения в удаленный репозиторий.

git push origin master

Команда pull забирает изменения указанной ветки из удаленного репозитория
и сливает их в текущую ветку.

git pull origin master

Команда fetch забирает все изменения из удаленного репозитория.

git fetch

35

