Санкт-Петербургский государственный университет
телекоммуникаций
им. проф. М. А. Бонч-Бруевича
Кафедра Защищенных систем связи

Разработка защищенного
программного обеспечения

Лекция №9

Автоматизация сборки и развертывания
проектов

2

Maven. Основные понятия
Maven – это средство для управления и сборки проектов. Он
позволяет разработчикам полностью управлять жизненным
циклом проекта.
Благодаря этому, команда может автоматизировать процессы,
связанные со сборкой, тестирование, упаковкой проекта и т.д.
В случае, когда над проектом работает несколько команд
разработчиков, Maven позволяет работать в соответствии с
определенными стандартами.

3

Аспекты, которыми позволяет управлять Maven
• Создание
• Документирование
• Отчёты
• Зависимости
• Релизы
• SCM
• Список рассылки
• Дистрибьюция
4

Цель создания Maven
Основной целью Maven является предоставление
разработчику:
• Понятной модели для проектов, которая может быть
использована повторно и была бы проста в поддержании.
• Плагины, которые могут взаимодействовать с этой моделью.
• Структура и содержание проекта Maven указывается в
специальном xml-файле, который называется Project Object
Model (POM), который является базовым модулем всей
системы.

5

Соглашение по конфигурации
Разработчики не обязаны указывать каждую деталь. Maven обеспечивает поведение
проекта по умолчанию. Когда мы создаём проект с использованием этой технологии, то
Maven создаёт базовую структуру проекта. Разработчики несут ответственность только
за соответственное размещение файлов.
Ниже указаны значения по умолчанию для исходного кода проекта и других модулей.

Для того, чтобы построить проект, Maven предоставляет нам настройки для управления
жизненным циклом проекта и его зависимостями. Большая часть его задач поддерживается
плагинами Maven.
6

Project Object Model
POM является базовым модулем Maven. Это специальный XMLфайл, который всегда хранится в базовой директории проекта и
называется pom.xml. Файл POM содержит информацию о
проекте, различных деталях конфигурации, задачи и плагины.
Во время выполнения задач, Maven ищет файл pom.xml в
базовой директории проекта. Он читает его и получает
необходимую информацию, после чего выполняет задачи.
Перед тем, как создавать pom.xml нам необходимо прежде
всего определить группу проекта (groupId), его имя (artifactId) и
его версию. Все это поможет унифицировать проект для простой
его идентификации в репозитории.
7

Пример pom.xml файла

8

Super POM
Все POM-файлы являются наследниками родительского
POM. Этот POM-файл называется Super POM и содержит
значения, унаследованные по умолчанию.
Простой способ просмотреть настройки по умолчанию Super
POM файла – это использование команды:
mvn help:effective-pom
Maven также обеспечивает множество архитипов для
создания проектов для создания определённой структуры и
файла pom.xml
9

Жизненный цикл сборки
Жизненный цикл сборки в Maven – это чётко определённая
последовательность фаз во время выполнения которых должны быть
достигнуты определённые цели.
Каждая из этих фаз имеет
фазы pre и post. Они
могут быть использованы
для регистрации задач,
которые должны быть
запущены перед и после
указанной фазы.

10

Жизненный цикл сборки
Когда Maven начинает сборку проекта, он проходит через
определённую последовательность фаз и выполняет
определённые задачи, которые указаны в каждой из фаз.
Maven имеет следующие 3 стандартных жизненных цикла:
• clean
• default
• site

11

Жизенный цикл Clean
Задача clean Maven (clean:clean) привязывается к фазе clean
в жизненном цикле сборки. Эта задача удаляет ввод сборки
путём удаления директории сборки. Таким образом, когда
выполняется команда mvn clean, Maven удаляет
директорию сборки.

12

Жизненный цикл Default (Build)
Это основной жизненный цикл Maven, который
используется для сборки проектов. Он включает в себя 23
фазы.
Необходимо уточнить два момента:
• Когда мы выполняем команду Maven, например install, то
будут выполнены фазы до install и фаза install.
• Различные задачи Maven будут привязаны к различным
фазам жизненного цикла Maven в зависимости от типа
архива (JAR/WAR/EAR).
13

Жизненный цикл Site
Плагин Maven – Site – используется для создания докладов,
документации, развёртывания и т.д.
Он включает в себя такие фазы:
• pre-site
• site
• post-site
• site-deploy

14

Профиль сборки
Профиль сборки – это множество настроек, которые могут
быть использованы для установки или перезаписи
стандартных значений сборки Maven.
Профили настраиваются в файле pom.xml с помощью
элементов activeProfiles / profiles и запускаются различными
методами. Профили изменяют файл pom.xml во время
сборки и используются для передачи параметров
различным целевым окружениям.

15

Типы профилей сборки

16

Активация профиля
Профиль сборки Maven может быть активирован
различными способами:
• Использованием команды в консоли
• С помощью настроек Maven
• С помощью переменных окружения
• Настройках ОС
• Существующими, отсутствующими файлами.

17

Репозитории
При работе с Maven под репозиторием мы понимаем
директорию, где хранятся все JAR, библиотеки, плагины и
любые артефакты, которыми Maven может воспользоваться.
Существует три типа репозиториев Maven:
• локальные (local)
• центральные (central)
• удалённые (remote)

18

Плагины
Плагины Maven используются для:
• создания jar – файла
• создания war – файла
• компиляции кода файлов
• юнит-тестирования кода
• создание отчётов проекта
• создание документации проекта
В общей форме, плагин обеспечивает набор целей, которые могут быть
выполнены с помощью такого синтаксиса:

19

Создание проекта
Для создания проекта, Maven использует архитипы. Для
создания простого Java приложения, используют
плагин mvn-archetype-quickstart.

20

Сборка и тестирование проекта
Maven автоматически добавляет зависимости Junit в наш
проект.
Вписываем команду mvn clean package

21

Сборка и тестирование проекта
Теперь пробуем запустить приложение, выполнив
команду
cd target/classes
Затем
java net.proselyte.mavensimple.App
В результате получим

/*Some system messages*/
Hello World!
22

Документирование проекта
Для создания документации необходимо перейти в
директорию проекта.
После этого выполнить в терминале команду mvn site
Maven создаёт документацию с помощью механизма
documentation-processing, который называется Doxia,
который считывает различные форматы в один документ.

23

Автоматизация сборки
Автоматизация сборки – это механизм определения
сценария, по которому процесс сборки проекта начинается
после того, как проект был однажды

24

Автоматизация развёртывания (deployment)
При разработке проекта процесс развёртывания состоит из
следующих шагов:
• Проверка всего кода проекта в системе контроля версий.
• Скачивание всего исходного кода из системы контроля версий.
• Сборка приложения.
• Получение WAR или EAR файла проекта.
• Развёртывание файла на сервере.
• Обновление документации и обновление номера версии
приложения.
Если выполнять эти операции вручную, то шанс что-то упустить
достаточно высок, поэтому
25

Автоматизация развёртывания комбинированием
• Сборки и релиза проекта с помощью Maven;
• Использование системы контроля версий (например, Git)
для работы с кодом;
• Использования систем управления удалёнными
репозиториями (например, Nexus).

26

Автоматизация развёртывания комбинированием
Обновим pom.xml проект
Для автоматизирования релиза продукта используется плагин Maven
Release.
В pom.xml файле использовались следующие важные элементы:
• Repositories
Место, где выполняется сборка JAR, WAR, или EAR или другие
артефакты, которые будут получены в случае успешной сборки.
• Plugin
Элемент maven-release-plugin сконфигурирован для автоматизации
процесса развёртывания.
• SCM
Определяет расположение системы контроля версий, в которой
Maven выполнит проверку исходного кода.
27

Автоматизация развёртывания комбинированием
С помощью команды maven-release-plugin Maven выполняет
следующие задачи:
mvn release:clean
Выполняет очистку в случае, если релиз был не успешным
mvn release:rollback
Откатывает изменения, которые были сделаны в коде и
конфигурациях, если полследний релиз не был успешным

28

Автоматизация развёртывания комбинированием
<pre>
<code>
mvn release:perform
</code>
</pre>
Проверяет код, используя предыдущую метку и запускает цель
Maven – deploy – для развертывания артефакта, полученного в
результате сборки на репозитории.
После того, как проект был успешно запущен выполняется
загрузка артефакта в репозиторий.
29

Gradle. Основные понятия
Gradle - система автоматической сборки, построенная на
принципах Apache Ant и Apache Maven, но
предоставляющая DSL на языках Groovy и Kotlin вместо
традиционной XML-образной формы представления
конфигурации проекта.

30

Android Gradle plugin
Gradle сам по себе ничего не знает о том, как билдить Androidпроект, в этом ему помогает плагин, который разрабатывается
вместе с Android SDK. В главном сборочном скрипте build.gradle
студия самостоятельно добавляет зависимость от этого плагина.

31

Android Gradle plugin
В скрипте основного модуля этот плагин
автоматически подключается строчкой apply
plugin: 'com.android.application'. Именно
поэтому у в скрипте есть секция android { ... }, в
которой можно узнать версию Build Tools,
версии SDK для сборки и прочее.

32

BuildConfig
BuildConfig — это автоматически генерируемый при сборке
класс, который содержит только константы. Этот класс
генерируется отдельно для каждого модуля в твоем проекте
и по умолчанию включает в себя информацию об ID
приложения, версии, типе сборки.

33

BuildConfig
Редактирование вручную этого файла бесполезно, так как он
все равно перезатрется новыми данными при сборке. Зато
Android-плагин может добавлять в него те поля, которые
задаются пользователем.

34

Добавление данных в ресурсы
Принцип точно такой же, что и с BuildConfig, но позволяет
добавлять значения в файл ресурсов. Но зачем добавлять
ресурс из конфига, если проще это сделать, как обычно, в
XML-файле? Просто потому, что в скрипте, так же как и в
случае с BuildConfig.TIMEOUT, значение ресурса можно
вычислить. Например, сохранить дату сборки:

35

Gradle создаст специальный файл generated.xml примерно
такого содержания (только, разумеется, с правильными
угловыми скобочками):
[?xml version="1.0" encoding="utf-8"?]
[resources]
[!-- Automatically generated file. DO NOT MODIFY --]
[!-- Values from default config. --]
[string name="BUILD_TIME" translatable="false"]1471574224[/string]
[/resources]

Учёт времени записывается в формате String. К сожалению,
Android SDK не умеет хранить в ресурсах long, а в 32-битный
integer время не влезет.
36

Варианты сборки
Build types используют, чтобы иметь возможность собирать
приложение с существенными отличиями.
Чтобы собрать нужный тип, выполняем команду gradle
assemble<ИмяТипаСборки>, например gradle assembleDebug или
gradle assembleQa.
Product flavors дополняют build types и вносят еще один уровень
гибкости в настройку сборки. Их используют, когда необходимо не
глобально изменить приложение, — это могут быть брендинг
(иконки, цвета, тексты), окружение (адрес сервера, платформа, trialили pro-версии).

37

Варианты сборки
Build type и product flavor в сумме дают так называемый итоговый Build Variant, собрать
который можно по схеме gradle assemble<ИмяПродукта><ИмяТипаСборки>. Если
требуется запустить эти сборки не из консоли, а из студии, надо открыть вкладку Build
Variants и выбрать необходимое

Каждая из секций buildTypes и productFlavors {...} может иметь свои buildConfigField {...},
resValue, versionName и другие параметры, которые будут приоритетнее, чем те, что
объявлены в defaultConfig {...}.
38

Настройка информации о приложении
Имея несколько вариантов сборок, хочется их идентифицировать или различать
после установки.
Как раз для этого у Android-плагина есть парочка параметров — applicationIdSuffix и
versionNameSuffix, которые добавляют к существующему ID приложения и к
существующей версии то, что хочет пользователь.
Команда gradle assembleTrialRelease собирает приложение с
applicationId="example.myawesomeapp.release" и названием версии
MyAwesomeApp-trial.

39

